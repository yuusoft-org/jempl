file: '../customFunctions.js'
group: parseAndRender
suites: [when]
---
### When Directive End-to-End Tests
suite: when
exportName: default
---
case: simple when condition true
in:
  - $when: isActive
    type: "button"
    label: "Click me"
  - isActive: true
  - functions: {}
out:
  type: "button"
  label: "Click me"
---
case: simple when condition false
in:
  - $when: isActive
    type: "button"
    label: "Click me"
  - isActive: false
  - functions: {}
out: {}
---
case: when with comparison operators
in:
  - items:
      - $when: age >= 18
        status: "adult"
        canVote: true
      - $when: age < 18
        status: "minor"
        canVote: false
  - age: 25
  - functions: {}
out:
  items:
    - status: "adult"
      canVote: true
---
case: when in array filtering
in:
  - products:
      - $when: inStock
        id: 1
        name: "Product A"
        available: true
      - $when: "!inStock"
        id: 2
        name: "Product B"
        available: false
      - id: 3
        name: "Product C"
        available: true
  - inStock: true
  - functions: {}
out:
  products:
    - id: 1
      name: "Product A"
      available: true
    - id: 3
      name: "Product C"
      available: true
---
case: when with logical operators
in:
  - access:
      $when: isLoggedIn && (isAdmin || isOwner)
      dashboard: "Full Access"
      settings: "Edit All"
  - isLoggedIn: true
    isAdmin: false
    isOwner: true
  - functions: {}
out:
  access:
    dashboard: "Full Access"
    settings: "Edit All"
---
case: nested when conditions - outer true, inner mixed
in:
  - app:
      $when: appEnabled
      header:
        $when: showHeader
        title: "My App"
        logo: "logo.png"
      content:
        $when: hasContent
        text: "Welcome"
      footer:
        copyright: "2024"
  - appEnabled: true
    showHeader: true
    hasContent: false
  - functions: {}
out:
  app:
    header:
      title: "My App"
      logo: "logo.png"
    footer:
      copyright: "2024"
---
case: nested when conditions - outer false, inner true
in:
  - app:
      $when: appEnabled
      header:
        $when: showHeader
        title: "My App"
        logo: "logo.png"
      content:
        $when: hasContent
        text: "Welcome"
      footer:
        copyright: "2024"
  - appEnabled: false
    showHeader: true
    hasContent: true
  - functions: {}
out: {}
---
case: nested when conditions - outer true, all inner false
in:
  - app:
      $when: appEnabled
      header:
        $when: showHeader
        title: "My App"
        logo: "logo.png"
      content:
        $when: hasContent
        text: "Welcome"
      footer:
        copyright: "2024"
  - appEnabled: true
    showHeader: false
    hasContent: false
  - functions: {}
out:
  app:
    footer:
      copyright: "2024"
---
case: when with variables in properties
in:
  - user:
      $when: showUserInfo
      name: "${firstName} ${lastName}"
      email: "${email}"
      age: "${age}"
  - showUserInfo: true
    firstName: "John"
    lastName: "Doe"
    email: "john@example.com"
    age: 30
  - functions: {}
out:
  user:
    name: "John Doe"
    email: "john@example.com"
    age: 30
---
case: when combined with if statements
in:
  - card:
      $when: showCard
      title: "User Card"
      $if isPremium:
        badge: "Premium"
        features: ["Feature A", "Feature B"]
      $else:
        badge: "Basic"
        features: ["Feature A"]
  - showCard: true
    isPremium: true
  - functions: {}
out:
  card:
    title: "User Card"
    badge: "Premium"
    features: ["Feature A", "Feature B"]
---
case: when prevents if evaluation when false
in:
  - section:
      $when: showSection
      $if hasData:
        content: "${data}"
      $else:
        content: "No data"
  - showSection: false
    hasData: true
    data: "Important data"
  - functions: {}
out: {}
---
case: array with multiple when conditions
in:
  - menu:
      - $when: true
        label: "Home"
        path: "/"
      - $when: isLoggedIn
        label: "Dashboard"
        path: "/dashboard"
      - $when: isAdmin
        label: "Admin"
        path: "/admin"
      - $when: false
        label: "Hidden"
        path: "/hidden"
  - isLoggedIn: true
    isAdmin: false
  - functions: {}
out:
  menu:
    - label: "Home"
      path: "/"
    - label: "Dashboard"
      path: "/dashboard"
---
case: when with in operator
in:
  - permissions:
      - $when: userRole in deleteRoles
        action: "delete"
        resource: "posts"
      - $when: userRole in readRoles
        action: "read"
        resource: "posts"
      - $when: userRole == "admin"
        action: "manage"
        resource: "users"
  - userRole: "moderator"
    deleteRoles: ["admin", "moderator"]
    readRoles: ["admin", "moderator", "user"]
  - functions: {}
out:
  permissions:
    - action: "delete"
      resource: "posts"
    - action: "read"
      resource: "posts"
---
case: complex real-world example
in:
  - layout:
      type: "page"
      header:
        $when: "!isEmbedded"
        logo: "logo.png"
        navigation:
          - $when: true
            label: "Home"
            url: "/"
          - $when: isAuthenticated
            label: "Profile"
            url: "/profile"
          - $when: isAuthenticated && hasNotifications
            label: "Notifications (${notificationCount})"
            url: "/notifications"
      main:
        sidebar:
          $when: showSidebar && screenSize != "mobile"
          width: 250
          items:
            - $when: hasRecentItems
              title: "Recent"
              count: "${recentCount}"
        content:
          title: "${pageTitle}"
          $if isLoading:
            status: "Loading..."
          $else:
            status: "Ready"
            data: "${contentData}"
  - isEmbedded: false
    isAuthenticated: true
    hasNotifications: true
    notificationCount: 5
    showSidebar: true
    screenSize: "desktop"
    hasRecentItems: false
    pageTitle: "Dashboard"
    isLoading: false
    contentData: "Main content here"
  - functions: {}
out:
  layout:
    type: "page"
    header:
      logo: "logo.png"
      navigation:
        - label: "Home"
          url: "/"
        - label: "Profile"
          url: "/profile"
        - label: "Notifications (5)"
          url: "/notifications"
    main:
      sidebar:
        width: 250
        items: []
      content:
        title: "Dashboard"
        status: "Ready"
        data: "Main content here"
---
case: when with undefined variables defaults to false
in:
  - item:
      $when: undefinedVariable
      value: "Should not appear"
    fallback: "Always appears"
  - otherVariable: true
  - functions: {}
out:
  fallback: "Always appears"
---
case: when with null and falsy values
in:
  - tests:
      - $when: nullValue
        label: "null is falsy"
      - $when: zeroValue
        label: "zero is falsy"
      - $when: emptyString
        label: "empty string is falsy"
      - $when: falseValue
        label: "false is falsy"
      - $when: emptyArray
        label: "empty array is truthy"
      - $when: emptyObject
        label: "empty object is truthy"
  - nullValue: null
    zeroValue: 0
    emptyString: ""
    falseValue: false
    emptyArray: []
    emptyObject: {}
  - functions: {}
out:
  tests:
    - label: "empty array is truthy"
    - label: "empty object is truthy"
---
case: when preserves data types in properties
in:
  - data:
      $when: includeData
      string: "text"
      number: 42
      boolean: true
      null: null
      array: [1, 2, 3]
      object:
        nested: "value"
  - includeData: true
  - functions: {}
out:
  data:
    string: "text"
    number: 42
    boolean: true
    null: null
    array: [1, 2, 3]
    object:
      nested: "value"
---
case: when with nested paths
in:
  - profile:
      $when: user.profile.isPublic
      name: "${user.profile.name}"
      bio: "${user.profile.bio}"
  - user:
      profile:
        isPublic: true
        name: "Alice"
        bio: "Software Developer"
  - functions: {}
out:
  profile:
    name: "Alice"
    bio: "Software Developer"
---
case: when with function calls in values
in:
  - computed:
      $when: showComputed
      result: "${add(10, 20)}"
  - showComputed: true
out:
  computed:
    result: 30
---
case: empty array after all when conditions false
in:
  - items:
      - $when: false
        id: 1
      - $when: showSecond
        id: 2
      - $when: showThird
        id: 3
  - showSecond: false
    showThird: false
  - functions: {}
out:
  items: []
---
case: when at root level
in:
  - $when: includeEverything
    prop1: "value1"
    prop2: "value2"
    nested:
      prop3: "value3"
  - includeEverything: true
  - functions: {}
out:
  prop1: "value1"
  prop2: "value2"
  nested:
    prop3: "value3"
---
case: when at root level false returns empty object
in:
  - $when: includeEverything
    prop1: "value1"
    prop2: "value2"
  - includeEverything: false
  - functions: {}
out: {}
---
case: when with function calls
in:
  - inventory:
      $when: count(items) > 0
      total: "${count(items)} items"
      status: "has inventory"
  - items: ["apple", "banana", "cherry"]
out:
  inventory:
    total: "3 items"
    status: "has inventory"
---
case: when with function calls - false condition
in:
  - inventory:
      $when: count(items) > 5
      total: "${count(items)} items"
      status: "has inventory"
  - items: ["apple", "banana"]
out: {}
---
case: when with arithmetic in condition
in:
  - achievement:
      $when: score + bonus > 100
      level: "high achiever"
      total: "${score} + ${bonus}"
  - score: 75
    bonus: 30
out:
  achievement:
    level: "high achiever"
    total: "75 + 30"
---
case: when with arithmetic - false condition
in:
  - achievement:
      $when: score + bonus > 150
      level: "high achiever"
      total: "${score} + ${bonus}"
  - score: 75
    bonus: 30
out: {}
---
case: when with function and arithmetic combined
in:
  - status:
      $when: getValue() + getBonus() - getPenalty() > getThreshold()
      message: "Threshold exceeded"
      calculation: "result is above limit"
  - {}
out:
  status:
    message: "Threshold exceeded"
    calculation: "result is above limit"
---
case: when in array with functions
in:
  - results:
      - $when: isEven(num)
        type: "even"
        value: "${num}"
      - $when: isPrime(num)
        type: "prime"
        value: "${num}"
      - type: "always"
        value: "constant"
  - num: 4
out:
  results:
    - type: "even"
      value: 4
    - type: "always"
      value: "constant"
---
case: when with arithmetic in array filtering
in:
  - products:
      - $when: price + tax <= budget
        name: "Product A"
        total: "${price} + ${tax} = within budget"
      - $when: price + tax > budget
        name: "Product B (over budget)"
        total: "${price} + ${tax} = over budget"
      - name: "Product C"
        total: "no calculation"
  - price: 80
    tax: 15
    budget: 100
out:
  products:
    - name: "Product A"
      total: "80 + 15 = within budget"
    - name: "Product C"
      total: "no calculation"
---
case: nested when with function conditions
in:
  - dashboard:
      $when: count(notifications) > 0
      header: "You have notifications"
      content:
        $when: count(notifications) > 5
        warning: "Too many notifications!"
        count: "${count(notifications)}"
  - notifications: ["msg1", "msg2", "msg3", "msg4", "msg5", "msg6", "msg7"]
out:
  dashboard:
    header: "You have notifications"
    content:
      warning: "Too many notifications!"
      count: 7
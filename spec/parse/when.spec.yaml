file: '../../src/parse/index.js'
group: parse
suites: [when]
---
### When Directive Tests
suite: when
exportName: default
---
case: simple when condition with boolean
in:
  - $when: isActive
    type: "button"
    label: "Click me"
out:
  type: 8
  fast: false
  whenCondition:
    type: 1
    path: "isActive"
  properties:
    - key: type
      value:
        type: 0
        value: "button"
    - key: label
      value:
        type: 0
        value: "Click me"
---
case: when with comparison operator
in:
  - $when: age >= 18
    status: "adult"
    canVote: true
out:
  type: 8
  fast: false
  whenCondition:
    type: 4
    op: 4
    left:
      type: 1
      path: "age"
    right:
      type: 0
      value: 18
  properties:
    - key: status
      value:
        type: 0
        value: "adult"
    - key: canVote
      value:
        type: 0
        value: true
---
case: when with logical AND
in:
  - $when: isActive && hasPermission
    action: "allowed"
out:
  type: 8
  fast: false
  whenCondition:
    type: 4
    op: 6
    left:
      type: 1
      path: "isActive"
    right:
      type: 1
      path: "hasPermission"
  properties:
    - key: action
      value:
        type: 0
        value: "allowed"
---
case: when with logical OR
in:
  - $when: isAdmin || isOwner
    canEdit: true
out:
  type: 8
  fast: false
  whenCondition:
    type: 4
    op: 7
    left:
      type: 1
      path: "isAdmin"
    right:
      type: 1
      path: "isOwner"
  properties:
    - key: canEdit
      value:
        type: 0
        value: true
---
case: when with negation
in:
  - $when: "!isDeleted"
    visible: true
out:
  type: 8
  fast: false
  whenCondition:
    type: 5
    op: 0
    operand:
      type: 1
      path: "isDeleted"
  properties:
    - key: visible
      value:
        type: 0
        value: true
---
case: when with complex condition
in:
  - $when: (age >= 18 && hasLicense) || isEmergency
    canDrive: true
out:
  type: 8
  fast: false
  whenCondition:
    type: 4
    op: 7
    left:
      type: 4
      op: 6
      left:
        type: 4
        op: 4
        left:
          type: 1
          path: "age"
        right:
          type: 0
          value: 18
      right:
        type: 1
        path: "hasLicense"
    right:
      type: 1
      path: "isEmergency"
  properties:
    - key: canDrive
      value:
        type: 0
        value: true
---
case: when with nested path
in:
  - $when: user.profile.isActive
    showProfile: true
out:
  type: 8
  fast: false
  whenCondition:
    type: 1
    path: "user.profile.isActive"
  properties:
    - key: showProfile
      value:
        type: 0
        value: true
---
case: when with in operator
in:
  - $when: role in allowedRoles
    hasAccess: true
out:
  type: 8
  fast: false
  whenCondition:
    type: 4
    op: 8
    left:
      type: 1
      path: "role"
    right:
      type: 1
      path: "allowedRoles"
  properties:
    - key: hasAccess
      value:
        type: 0
        value: true
---
case: when with string literal comparison
in:
  - $when: status == "active"
    enabled: true
out:
  type: 8
  fast: false
  whenCondition:
    type: 4
    op: 0
    left:
      type: 1
      path: "status"
    right:
      type: 0
      value: "active"
  properties:
    - key: enabled
      value:
        type: 0
        value: true
---
case: when with variables in properties
in:
  - $when: showUser
    name: "${user.name}"
    email: "${user.email}"
out:
  type: 8
  fast: false
  whenCondition:
    type: 1
    path: "showUser"
  properties:
    - key: name
      value:
        type: 1
        path: "user.name"
    - key: email
      value:
        type: 1
        path: "user.email"
---
case: when in array
in:
  - items:
      - $when: showFirst
        id: 1
        name: "First"
      - $when: showSecond
        id: 2
        name: "Second"
      - id: 3
        name: "Always"
out:
  type: 8
  fast: false
  properties:
    - key: items
      value:
        type: 9
        fast: false
        items:
          - type: 8
            fast: false
            whenCondition:
              type: 1
              path: "showFirst"
            properties:
              - key: id
                value:
                  type: 0
                  value: 1
              - key: name
                value:
                  type: 0
                  value: "First"
          - type: 8
            fast: false
            whenCondition:
              type: 1
              path: "showSecond"
            properties:
              - key: id
                value:
                  type: 0
                  value: 2
              - key: name
                value:
                  type: 0
                  value: "Second"
          - type: 8
            fast: true
            properties:
              - key: id
                value:
                  type: 0
                  value: 3
              - key: name
                value:
                  type: 0
                  value: "Always"
---
case: when with nested if inside
in:
  - $when: isVisible
    type: "container"
    $if hasContent:
      content: "Some content"
    $else:
      content: "Empty"
out:
  type: 8
  fast: false
  whenCondition:
    type: 1
    path: "isVisible"
  properties:
    - key: type
      value:
        type: 0
        value: "container"
    - key: "$if hasContent"
      value:
        type: 6
        conditions:
          - type: 1
            path: "hasContent"
          - null
        bodies:
          - type: 8
            fast: true
            properties:
              - key: content
                value:
                  type: 0
                  value: "Some content"
          - type: 8
            fast: true
            properties:
              - key: content
                value:
                  type: 0
                  value: "Empty"
        id: null
---
case: when with literal true
in:
  - $when: true
    always: "shown"
out:
  type: 8
  fast: false
  whenCondition:
    type: 0
    value: true
  properties:
    - key: always
      value:
        type: 0
        value: "shown"
---
case: when with literal false
in:
  - $when: false
    never: "shown"
out:
  type: 8
  fast: false
  whenCondition:
    type: 0
    value: false
  properties:
    - key: never
      value:
        type: 0
        value: "shown"
---
case: when with multiple comparison operators
in:
  - $when: age > 13 && age < 20
    category: "teenager"
out:
  type: 8
  fast: false
  whenCondition:
    type: 4
    op: 6
    left:
      type: 4
      op: 2
      left:
        type: 1
        path: "age"
      right:
        type: 0
        value: 13
    right:
      type: 4
      op: 3
      left:
        type: 1
        path: "age"
      right:
        type: 0
        value: 20
  properties:
    - key: category
      value:
        type: 0
        value: "teenager"
---
case: nested when conditions in complex structure
in:
  - dashboard:
      $when: user.isLoggedIn
      header:
        $when: user.showHeader
        title: "Dashboard"
      content:
        sections:
          - $when: user.hasSection1
            id: "section1"
          - $when: user.hasSection2
            id: "section2"
out:
  type: 8
  fast: false
  properties:
    - key: dashboard
      value:
        type: 8
        fast: false
        whenCondition:
          type: 1
          path: "user.isLoggedIn"
        properties:
          - key: header
            value:
              type: 8
              fast: false
              whenCondition:
                type: 1
                path: "user.showHeader"
              properties:
                - key: title
                  value:
                    type: 0
                    value: "Dashboard"
          - key: content
            value:
              type: 8
              fast: false
              properties:
                - key: sections
                  value:
                    type: 9
                    fast: false
                    items:
                      - type: 8
                        fast: false
                        whenCondition:
                          type: 1
                          path: "user.hasSection1"
                        properties:
                          - key: id
                            value:
                              type: 0
                              value: "section1"
                      - type: 8
                        fast: false
                        whenCondition:
                          type: 1
                          path: "user.hasSection2"
                        properties:
                          - key: id
                            value:
                              type: 0
                              value: "section2"